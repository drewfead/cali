syntax = "proto3";

package calendar;

option go_package = "github.com/drewfead/cali/proto";

import "google/protobuf/timestamp.proto";

service CalendarService {
  // AddEvent adds a one-time calendar event
  rpc AddEvent(AddEventRequest) returns (AddEventResponse);

  // UpdateEvent updates an existing calendar event
  rpc UpdateEvent(UpdateEventRequest) returns (UpdateEventResponse);

  // DeleteEvent removes a calendar event
  rpc DeleteEvent(DeleteEventRequest) returns (DeleteEventResponse);

  // GetEvent retrieves a single calendar event by ID
  rpc GetEvent(GetEventRequest) returns (GetEventResponse);

  // ListEvents streams all events from a calendar
  rpc ListEvents(ListEventsRequest) returns (stream ListEventsResponse);
}

message AddEventRequest {
  string summary = 1;
  optional string description = 2;  // supports HTML
  optional google.protobuf.Timestamp start_time = 3;
  optional google.protobuf.Timestamp end_time = 4;
  optional string location = 5;
  optional string calendar_id = 6;  // defaults to "primary"
  optional bool guests_can_see_other_guests = 7;  // default false
  optional bool guests_can_modify = 8;  // default false
  optional bool guests_can_invite_others = 9;  // default false
  optional string idempotency_key = 10;  // used to set event ID for deduplication
  optional string source_title = 11;  // title of the source of the event
  optional string source_url = 12;  // URL for the source of the event
  optional bool blocks_time = 13;  // default false (transparent), true means opaque
}

message AddEventResponse {
  string event_id = 1;
  bool success = 2;
  string message = 3;
  string html_link = 4;     // Link to view in Google Calendar
  string calendar_id = 5;   // Which calendar was used
}

message UpdateEventRequest {
  string event_id = 1;
  optional string calendar_id = 2;  // defaults to "primary"
  optional string summary = 3;
  optional string description = 4;  // supports HTML
  optional google.protobuf.Timestamp start_time = 5;
  optional google.protobuf.Timestamp end_time = 6;
  optional string location = 7;
  optional bool guests_can_see_other_guests = 8;
  optional bool guests_can_modify = 9;
  optional bool guests_can_invite_others = 10;
  optional string source_title = 11;
  optional string source_url = 12;
  optional bool blocks_time = 13;
}

message UpdateEventResponse {
  string event_id = 1;
  bool success = 2;
  string message = 3;
  string html_link = 4;
  string calendar_id = 5;
}

message DeleteEventRequest {
  string event_id = 1;
  optional string calendar_id = 2;  // defaults to "primary"
}

message DeleteEventResponse {
  bool success = 1;
  string message = 2;
  string calendar_id = 3;
}

message GetEventRequest {
  string event_id = 1;
  optional string calendar_id = 2;  // defaults to "primary"
}

message GetEventResponse {
  Event event = 1;
}

message ListEventsRequest {
  optional string calendar_id = 1;  // defaults to "primary"

  // Time filtering options (mutually exclusive with after/before)
  optional google.protobuf.Timestamp after = 2;   // only events after this time
  optional google.protobuf.Timestamp before = 3;  // only events before this time

  // Predefined time scopes (mutually exclusive with each other and with after/before)
  optional bool future = 4;  // events after now
  optional bool past = 5;    // events before now
  // If no time filter is specified, returns all events

  optional int32 limit = 6;  // page size (number of events per page)
  optional string anchor = 7;  // token for retrieving the next page of results
}

message ListEventsResponse {
  Event event = 1;  // the event (present for all messages except potentially the last)
  optional string next_anchor = 2;  // token for the next page (only set on the last message if more results exist)
}

message Event {
  string id = 1;
  string summary = 2;
  optional string description = 3;
  optional google.protobuf.Timestamp start_time = 4;
  optional google.protobuf.Timestamp end_time = 5;
  optional string location = 6;
  string html_link = 7;
  string calendar_id = 8;
  optional string status = 9;  // confirmed, tentative, cancelled
  repeated string attendees = 10;
  optional string transparency = 11;  // "opaque" (blocks time) or "transparent" (doesn't block time)
  optional string organizer_email = 12;
  optional string organizer_name = 13;
  optional string conference_uri = 14;  // Primary video conference link (Google Meet, Zoom, etc.)
  optional string conference_id = 15;   // Conference ID (e.g., "abc-defg-hij" for Meet)
  optional string source_title = 16;  // Title of the source of the event
  optional string source_url = 17;    // URL for the source of the event
}
